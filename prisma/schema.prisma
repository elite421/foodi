generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Admin {
  id        Int       @id @default(autoincrement())
  username  String    @unique
  password  String
  name      String    @default("Admin")
  createdAt DateTime  @default(now()) @map("created_at")
  sessions  Session[]

  @@map("admins")
}

model Session {
  id        String   @id @default(uuid())
  adminId   Int?     @map("admin_id")
  userId    String?  @map("user_id")
  expiresAt DateTime @map("expires_at")
  admin     Admin?   @relation(fields: [adminId], references: [id], onDelete: Cascade)
  user      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model User {
  id        String    @id
  name      String
  email     String    @unique
  phone     String    @unique
  createdAt DateTime  @default(now()) @map("created_at")
  addresses Address[]
  orders    Order[]
  sessions  Session[]

  @@map("users")
}

model Otp {
  id        String   @id @default(uuid())
  phone     String   @unique
  code      String
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("otps")
}

model Address {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  label     String   @default("Home")
  street    String
  city      String
  state     String
  zip       String
  lat       Float?
  lng       Float?
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  orders    Order[]

  @@map("addresses")
}

model Category {
  id        String     @id
  name      String
  icon      String     @default("")
  image     String     @default("")
  sortOrder Int        @default(0) @map("sort_order")
  items     MenuItem[]

  @@map("categories")
}

model MenuItem {
  id          String      @id @default(uuid())
  categoryId  String      @map("category_id")
  name        String
  description String      @default("")
  image       String      @default("")
  price       Float       @default(0)
  isVeg       Boolean     @default(true) @map("is_veg")
  isAvailable Boolean     @default(true) @map("is_available")
  sortOrder   Int         @default(0) @map("sort_order")
  category    Category    @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  orderItems  OrderItem[]

  @@map("menu_items")
}

model Coupon {
  id             String   @id @default(uuid())
  code           String   @unique
  discountType   String   @default("PERCENTAGE") // PERCENTAGE or FLAT
  discountValue  Float
  minOrderValue  Float    @default(0) @map("min_order_value")
  maxDiscount    Float?   @map("max_discount")
  isActive       Boolean  @default(true) @map("is_active")
  createdAt      DateTime @default(now()) @map("created_at")

  @@map("coupons")
}

model Order {
  id               String      @id // 7 chars alphanumeric
  userId           String      @map("user_id")
  addressId        String?     @map("address_id")
  status           String      @default("PENDING") // PENDING, ACCEPTED, PREPARING, OUT_FOR_DELIVERY, DELIVERED, CANCELLED
  paymentMethod    String      @default("COD") @map("payment_method") // COD, ONLINE
  paymentStatus    String      @default("PENDING") @map("payment_status") // PENDING, COMPLETED, FAILED, REFUNDED
  paymentId        String?     @map("payment_id")
  subtotal         Float
  tax              Float
  deliveryFee      Float       @map("delivery_fee")
  discount         Float       @default(0)
  total            Float
  couponCode       String?     @map("coupon_code")
  specialInstructions String?  @map("special_instructions")
  createdAt        DateTime    @default(now()) @map("created_at")
  user             User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  address          Address?    @relation(fields: [addressId], references: [id], onDelete: SetNull)
  items            OrderItem[]

  @@map("orders")
}

model OrderItem {
  id            String   @id @default(uuid())
  orderId       String   @map("order_id")
  menuItemId    String   @map("menu_item_id")
  quantity      Int
  priceAtTime   Float    @map("price_at_time")
  order         Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  menuItem      MenuItem @relation(fields: [menuItemId], references: [id], onDelete: Restrict)

  @@map("order_items")
}

model Settings {
  id             Int     @id @default(1)
  siteName       String  @default("FoodiClub") @map("site_name")
  tagline        String  @default("Your favorite restaurant, online")
  domain         String  @default("foodiclub.com")
  phone          String  @default("1800-123-4567")
  email          String  @default("support@foodiclub.com")
  address        String  @default("123 Food Street, New Delhi, India")
  facebook       String  @default("https://facebook.com/foodiclub")
  instagram      String  @default("https://instagram.com/foodiclub")
  twitter        String  @default("https://twitter.com/foodiclub")
  primaryColor   String  @default("#4338ca") @map("primary_color")
  secondaryColor String  @default("#f59e0b") @map("secondary_color")
  
  // Single Restaurant specific settings
  restaurantLat  Float   @default(28.6139) @map("restaurant_lat")
  restaurantLng  Float   @default(77.2090) @map("restaurant_lng")
  deliveryRadius Float   @default(10.0) @map("delivery_radius") // in km
  taxPercentage  Float   @default(5.0) @map("tax_percentage")
  baseDeliveryFee Float  @default(40.0) @map("base_delivery_fee")
  razorpayKeyId   String @default("") @map("razorpay_key_id")
  razorpayKeySecret String @default("") @map("razorpay_key_secret")

  @@map("settings")
}

model Hero {
  id                Int    @id @default(1)
  title             String @default("Welcome to FoodiClub!")
  subtitle          String @default("Order from our exclusive menu.")
  promoText         String @default("Use code: FC50 to get FLAT 50% OFF on your 1st order.") @map("promo_text")
  searchPlaceholder String @default("What are you craving today?") @map("search_placeholder")
  statsRating       String @default("5.0 rated") @map("stats_rating")
  statsDownloads    String @default("10K+ Happy Customers") @map("stats_downloads")
  statsCities       String @default("Fast Delivery in city") @map("stats_cities")
  bannerTitle       String @default("BUY 1 GET 1") @map("banner_title")
  bannerHighlight   String @default("FREE") @map("banner_highlight")
  bannerSubtitle    String @default("ALL DAY, EVERYDAY") @map("banner_subtitle")

  @@map("hero")
}

// We will keep Offers & Collections & Pages mostly as-is, just adapt them for single restaurant concept.
model Offer {
  id         String  @id
  title      String  @default("")
  subtitle   String  @default("")
  image      String  @default("")
  bgColor    String  @default("#4338ca") @map("bg_color")
  active     Boolean @default(true)

  @@map("offers")
}

model Collection {
  id    String @id
  title String @default("")
  image String @default("")
  link  String @default("/menu")

  @@map("collections")
}

model Elite {
  id           Int    @id @default(1)
  title        String @default("ELITE")
  tagline      String @default("Claim your Elite benefits")
  freeDelivery String @default("above ₹199") @map("free_delivery")
  freeDishes   String @default("above ₹449") @map("free_dishes")

  @@map("elite")
}

model EliteItem {
  id        String @id
  label     String @default("")
  image     String @default("")
  sortOrder Int    @default(0) @map("sort_order")

  @@map("elite_items")
}

model Page {
  id              String   @id
  title           String
  slug            String   @unique
  content         String   @default("")
  metaDescription String   @default("") @map("meta_description")
  published       Boolean  @default(true)
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@map("pages")
}
